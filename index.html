<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link rel="icon" href="data:,"> <!-- Fix favicon issue -->
    <style>
        #chatbox { width: 100%; height: 300px; overflow-y: auto; border: 1px solid black; padding: 10px; }
        .user-message { color: blue; font-weight: bold; }
        .bot-message { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Chatbot</h1>
    <div id="chatbox"></div>
    <input type="text" id="userInput" placeholder="Type your message here...">
    <button id="sendButton">Send</button>
    <button id="voiceButton">üéôÔ∏è Speak</button>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const sendButton = document.getElementById("sendButton");
            const voiceButton = document.getElementById("voiceButton");
            const userInput = document.getElementById("userInput");
            const chatbox = document.getElementById("chatbox");

            if (!sendButton || !voiceButton || !userInput) {
                console.error("‚ùå Error: Missing required elements in HTML.");
                return;
            }

            function sendMessage(message) {
                let userMessage = message || userInput.value.trim();
                if (!userMessage) return;

                let userDiv = document.createElement("div");
                userDiv.textContent = "You: " + userMessage;
                userDiv.classList.add("user-message");
                chatbox.appendChild(userDiv);

                fetch("https://smokeshop-chatbot.onrender.com/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ "message": userMessage })
                })
                .then(response => response.json())
                .then(data => {
                    let botDiv = document.createElement("div");
                    botDiv.textContent = "Bot: " + (data.response || "No response received");
                    botDiv.classList.add("bot-message");
                    chatbox.appendChild(botDiv);
                    chatbox.scrollTop = chatbox.scrollHeight;
                })
                .catch(error => {
                    console.error("Error:", error);
                    let errorDiv = document.createElement("div");
                    errorDiv.textContent = "Error: Unable to connect to chatbot.";
                    errorDiv.classList.add("error-message");
                    chatbox.appendChild(errorDiv);
                });

                userInput.value = "";
            }

            sendButton.addEventListener("click", sendMessage);
            userInput.addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    sendMessage();
                }
            });

            if ("webkitSpeechRecognition" in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = "en-US";

                voiceButton.addEventListener("click", function () {
                    recognition.start();
                });

                recognition.onresult = function (event) {
                    const transcript = event.results[0][0].transcript;
                    userInput.value = transcript;
                    sendMessage(transcript);
                };

                recognition.onerror = function (event) {
                    console.error("Voice recognition error:", event.error);
                };
            } else {
                voiceButton.style.display = "none";
                console.warn("Speech Recognition is not supported in this browser.");
            }
        });
    </script>
</body>
</html>

